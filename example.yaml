# Legend:
#
#    Internal connections:
#    "-->"  -- one to one connection
#    "-=>"  -- one to many connection
#    "==>"  -- many to many connection
#    "=->"  -- many to one connection
#
#    "failover: " -- (at the start of the line) override priority
#                   for the following connections
#
#    Nodes:
#     "name" -- name of class from classification
#     "_name" -- name of external port (with respect to currently
#                 described subtopology)
#     "port:cluster" -- the port of the subcluster
#     "A --> {B, C}" is a shortcut to "A -> B" and "A -> C"

type: reqrep

priorities:
  default: 8  # just like the default of nanomsg
  failover: 10  # a failover priority

subgraphs:
  cluster: |
    # normal flow
    _api ==> frontend ==> load_balancer -=> worker
    # failover
    failover: load_balancer =-> gateway_output
    gateway_output -=> _failover_output
    _failover_input =-> gateway_input -=> load_balancer

  subcluster: |
    _worker =-> device -=> worker

  public: |
    _api ==> api
    failover_output ==> failover_input

